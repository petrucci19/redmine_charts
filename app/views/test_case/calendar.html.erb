<% content_for :head do %>
	<script type="text/javascript">
		var select, test_case_calendar;

		/*Date.prototype.yyyymmdd = function() {
		   var yyyy = this.getFullYear().toString();
		   var mm = (this.getMonth()+1).toString();
		   var dd  = this.getDate().toString();
		   return yyyy + "-" + (mm[1]?mm:"0"+mm[0]) + "-" + (dd[1]?dd:"0"+dd[0]);
		};

		var d = new Date();
		var t = d.yyyymmdd();
		//alert(t);*/
		var arr= new Array();
		var x,i,temp;
		var weekday = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
		var month = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];
		var array = [[0, 2, 0], [0, 2, 0], [0, 2, 0], [0, 2, 0], [0, 2, 0], [0, 2, 0], [0, 2, 0]];
		var table1 = document.getElementById('labels_table');
		var cell;
		var ns,f,p;
		
		function calendarDayRenderer(){
			jQuery.ajax( {
                   
		        cache: false,
		        url: '/calendar/' + select,
		        dataType: "json",
		        success:  function(data){ 
		        	//console.log(select);                
		        	//console.log(data);
		        	arr=new Array();		        	
		        	x=10;
		        	i=0;
		        	table1 = document.getElementById('labels_table');
		        	for (var key in data) {
					  if (data.hasOwnProperty(key)) {
					  	var date_arr = key.split("-");
					  	var d = new Date(date_arr[0],date_arr[1]-1,date_arr[2]);
					  	var date_str = "day-"+ date_arr[0] + "-" + date_arr[1] + "-" + date_arr[2];
					  	var str = weekday[d.getDay()] + ", " + month[d.getMonth()] + " " + date_arr[2];
						var bubble_opt = { label: date_str , color : "#000000"};
					  	if (data[key]>3) {
					  		bubble_opt.color="#868686";
					  	}

					  	cell = table1.rows[0].cells[i];
					  	cell.firstChild.data = str;
					    arr.push(new Array(x,2,data[key],bubble_opt));
					  }
					  x += 10; i+=1;
					}
					test_case_calendar.series[0].data= arr;
					test_case_calendar.replot();
					
		    	},
		    	error : function(XMLHttpRequest, textStatus, errorThrown) { console.log('Error calendar ajax!'); }

		    });
		};

		function calendarWeekRenderer(){
			jQuery.ajax( {
                   
		        cache: false,
		        url: '/calendar/' + select,
		        dataType: "json",
		        success:  function(data){ 
		        	//console.log(select);                
		        	console.log(data);
		        	arr=new Array();		        	
		        	x=10;
		        	i=0;
		        	table1 = document.getElementById('labels_table');
		        	for (var key in data) {
					  if (data.hasOwnProperty(key)) {
					  	var date_arr = key.split("-");
					  	var date_str = "week-" + date_arr[0] + "-" + date_arr[1];
					  	var str = "Week " + date_arr[1] + ", " + date_arr[0];
					  	var bubble_opt = { label: date_str , color: "#00FF66"};
					  	if (data[key]>3) {
					  		bubble_opt.color="#00CC66";
					  	}

					  	cell = table1.rows[0].cells[i];
					  	cell.firstChild.data = str;
					    arr.push(new Array(x,2,data[key],bubble_opt));
					  }
					  x += 10; i+=1;
					}
				
					test_case_calendar.series[0].data= arr;  
			        test_case_calendar.replot();
		    	},
		    	error : function(XMLHttpRequest, textStatus, errorThrown) { console.log('Error calendar ajax!'); }

		    });
		};

		$(document).ready(function(){

			$('#tooltip1b').hide();
			table1 = document.getElementById('labels_table');
		     
		    test_case_calendar = $.jqplot('chart1',[array],{

		    	seriesColors: ["#898989"], 
				axes: {
			        xaxis: {
			        	min:10, max:100, numberTicks: 10, showTicks: false,
			        	//ticks: labels,
			        	tickOptions:{
					        showGridline: false
					        
					    }

			        },

			        yaxis: { min:0, max: 4, numberTicks: 3, showTicks: false,
			        	tickOptions:{
					        showGridline: false
					    }
			        }
			    },

		        seriesDefaults:{
		            renderer: $.jqplot.BubbleRenderer,
		            rendererOptions: {
		            	autoscaleBubbles:true,
		            	autoscaleMultiplier : 1.8,
		                bubbleAlpha: 1,
		                highlightAlpha: 0,
		                showLabels: false
		            },
		            shadow: true,
		            shadowAlpha: 0.05
		        },
		        grid: {borderWidth:0, background: '#ffffff', shadow:false}
		    });


		    $("#select_calendar").change(function() {
				select = $('select#select_calendar :selected').val();
				if (select=="empty") {
					test_case_calendar.series[0].data= array;
					test_case_calendar.replot();
					for (i=0;i<10;i++){
						cell = table1.rows[0].cells[i];
					  	cell.firstChild.data = "  ";
					}
				}
				if (select=="days") {
					calendarDayRenderer();
				}
				else if (select=="weeks"){
					calendarWeekRenderer();
				}
			});


			$('#chart1').bind('jqplotDataHighlight', 
			    function (ev, seriesIndex, pointIndex, data, radius) {    
					var chart_left = $('#chart1').offset().left,
					chart_top = $('#chart1').offset().top,
					x = test_case_calendar.axes.xaxis.u2p(data[0]),  // convert x axis unita to pixels
					y = test_case_calendar.axes.yaxis.u2p(data[1]);  // convert y axis units to pixels
					var color = 'rgb(50%,50%,100%)';
					
			      
			      	jQuery.ajax( {
                   		url: '/tooltip?date=' + data[3].label,
				        dataType: "json",
				        success:  function(kk){
				        	ns=f=p=0;                 
				        	//console.log(kk);
				    
				        	if(kk[1] != undefined) {ns= kk[1]};
				        	//console.log(ns);
				        	if(kk[2] != undefined) {f= kk[2]};
				        	if(kk[3] != undefined) {p= kk[3]};
				        	$('#tooltip1b').css({position:"absolute",left:chart_left+x+radius+5, top:chart_top+y, padding:"5px"});
							$('#tooltip1b').html('<span style="font: 15px "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif; color:#000; text-align:justify;">' + "<b>" + data[2] + " Test Cases:</b><br>" + ns +" Not Started<br>"+ f +" Failed<br>"+ p +" Passed<br>" );
							$('#tooltip1b').show();
				    	},
				    	error : function(XMLHttpRequest, textStatus, errorThrown) { console.log('Error tooltip ajax!'); }

				    });

					
				});
			   
			  // Bind a function to the unhighlight event to clean up after highlighting.
			$('#chart1').bind('jqplotDataUnhighlight', 
			      function (ev, seriesIndex, pointIndex, data) {
			          $('#tooltip1b').empty();
			          $('#tooltip1b').hide();
			      });
			
		});



	</script>
<% end %>


<h1>Test Cases</h1>

<select id="select_calendar">
	<option value="empty">--Select--</option>
	<option value="weeks">Last 10 weeks</option>
    <option value="days">Last 10 days</option>
</select>

<div id="chart_outer">
	<!--<p id="chart_labels">Labels here!</p>-->
	<table id="labels_table" border="0">
		<tr>
			<td id="1" style="width:10.3%"> </td>
			<td id="2" style="width:10%">  </td>
			<td id="3" style="width:10%">  </td>
			<td id="4" style="width:10%">  </td>
			<td id="5" style="width:10%">  </td>
			<td id="6" style="width:10%">  </td>
			<td id="7" style="width:10%">  </td>
			<td id="8" style="width:10%">  </td>
			<td id="9" style="width:10%">  </td>
			<td id="10" style="">  </td>
		</tr>
	</table>

	<div id="chart_inner">
		<div id='chart1' style="height:90px; width:860px;margin:0px;padding:0px;"></div>
	</div>
</div>

<div id="tooltip1b"></div>